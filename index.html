<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>XenoCare Pro — Xenotrasplante Simulado</title>
<style>
  body {
    margin: 0; background: #121212; color: #e0e0e0;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    display: flex; justify-content: center; align-items: center; min-height: 100vh;
    user-select: none;
  }
  .container {
    background: #1e1e1e;
    border-radius: 10px;
    width: 700px;
    max-width: 95vw;
    padding: 24px;
    box-shadow: 0 0 12px #444;
  }
  h1 {
    margin-top: 0; text-align: center; color: #90caf9;
    font-weight: 600;
    margin-bottom: 16px;
  }
  #status {
    font-weight: 600;
    margin-bottom: 10px;
    text-align: center;
  }
  #message {
    background: #263238;
    padding: 14px;
    border-radius: 6px;
    margin-bottom: 20px;
    min-height: 60px;
    line-height: 1.3;
    text-align: center;
  }
  #gameArea {
    display: flex;
    justify-content: space-around;
    gap: 20px;
    margin-bottom: 20px;
  }
  .entity {
    background: #2c3e50;
    border-radius: 12px;
    width: 280px;
    padding: 14px;
    box-shadow: inset 0 0 15px #111;
    user-select: none;
  }
  .entity h2 {
    text-align: center;
    color: #81d4fa;
    margin-bottom: 12px;
    font-weight: 700;
  }
  svg {
    display: block;
    margin: 0 auto 16px;
    max-width: 200px;
    height: auto;
  }
  #controls {
    text-align: center;
  }
  button {
    background: #1976d2;
    border: none;
    color: white;
    padding: 12px 20px;
    border-radius: 6px;
    font-size: 16px;
    cursor: pointer;
    margin: 0 10px;
    transition: background 0.3s ease;
  }
  button:hover:not(:disabled) {
    background: #1565c0;
  }
  button:disabled {
    background: #555;
    cursor: not-allowed;
  }
  .highlight {
    stroke: #ff7043;
    stroke-width: 3;
  }
  .hidden {
    display: none;
  }
</style>
</head>
<body>

<div class="container" role="main" aria-label="Simulación educativa de xenotrasplante">
  <h1>XenoCare Pro — Simulación de Xenotrasplante</h1>
  <div id="status">Estado: Preparación</div>
  <div id="message">Por favor, ponte los guantes para iniciar el procedimiento.</div>

  <div id="gameArea">
    <div class="entity" id="pigEntity" aria-label="Cerdo donante">
      <h2>Cerdo (Donante)</h2>
      <svg viewBox="0 0 200 300" aria-hidden="true" role="img" focusable="false">
        <defs>
          <linearGradient id="pigBodyGradient" x1="0" x2="0" y1="0" y2="1">
            <stop offset="0" stop-color="#ffd1dc"/>
            <stop offset="1" stop-color="#ffb3ca"/>
          </linearGradient>
        </defs>
        <ellipse cx="100" cy="180" rx="80" ry="60" fill="url(#pigBodyGradient)" />
        <circle cx="70" cy="110" r="40" fill="url(#pigBodyGradient)" />
        <circle cx="60" cy="100" r="6" fill="#2b2b2b" />
        <circle cx="80" cy="100" r="6" fill="#2b2b2b" />
        <ellipse cx="70" cy="120" rx="14" ry="10" fill="#ff9bb0" />
        <!-- Heart shape -->
        <g id="pigHeart" class="heart" transform="translate(100,180)" cursor="pointer" role="button" tabindex="0" aria-label="Extraer corazón del cerdo">
          <path d="M0 -22 C -9 -34 -32 -34 -32 -9 C -32 5 -15 15 0 32 C 15 15 32 5 32 -9 C 32 -34 9 -34 0 -22 Z" fill="#ff6b6b" />
        </g>
      </svg>
      <div style="text-align:center; font-size: 14px; color: #aaa;">Haz clic en el corazón para extraerlo</div>
    </div>

    <div class="entity" id="humanEntity" aria-label="Humano receptor">
      <h2>Humano (Receptor)</h2>
      <svg viewBox="0 0 200 300" aria-hidden="true" role="img" focusable="false">
        <circle cx="100" cy="80" r="35" fill="#f7e9d9" />
        <rect x="60" y="130" width="80" height="90" rx="15" ry="15" fill="#90caf9" />
        <rect x="80" y="190" width="40" height="50" rx="8" ry="8" fill="#bbdefb" />
        <!-- Chest area highlight -->
        <rect id="humanChest" x="72" y="150" width="56" height="38" rx="10" ry="10" fill="#0d47a1" opacity="0.2" />
      </svg>
      <div style="text-align:center; font-size: 14px; color: #aaa;">Arrastra el corazón aquí para implantar</div>
    </div>
  </div>

  <div id="controls">
    <button id="nextBtn">Comenzar</button>
    <button id="resetBtn" disabled>Reiniciar</button>
  </div>
</div>

<script>
  // Estados: 0=Preparación,1=Extracción,2=Compatibilidad,3=Implantación,4=Monitoreo,5=Finalizado
  const stages = ["Preparación", "Extracción", "Compatibilidad", "Implantación", "Monitoreo", "Finalizado"];

  let state = {
    stage: 0,
    heartExtracted: false,
    compatibilityPassed: false,
    vitals: 75,
    score: 0,
    draggingHeart: false,
  };

  const statusEl = document.getElementById("status");
  const messageEl = document.getElementById("message");
  const nextBtn = document.getElementById("nextBtn");
  const resetBtn = document.getElementById("resetBtn");

  const pigHeart = document.getElementById("pigHeart");
  const humanChest = document.getElementById("humanChest");

  // Create floating heart for dragging
  let floatingHeart = null;

  function updateStatus() {
    statusEl.textContent = `Estado: ${stages[state.stage]}`;
  }

  function setMessage(text) {
    messageEl.textContent = text;
  }

  function enableNext(enabled) {
    nextBtn.disabled = !enabled;
  }

  function startStage() {
    updateStatus();
    switch(state.stage) {
      case 0:
        setMessage("Ponte los guantes para iniciar el procedimiento.");
        enableNext(true);
        break;
      case 1:
        setMessage("Haz clic en el corazón del cerdo para extraerlo cuidadosamente.");
        enableNext(false);
        break;
      case 2:
        setMessage("Simulación de compatibilidad molecular: (simulada, sin mini-juego para brevedad). Pulsa siguiente para continuar.");
        enableNext(true);
        break;
      case 3:
        setMessage("Arrastra el corazón extraído al pecho del humano para implantarlo.");
        enableNext(false);
        createFloatingHeart();
        break;
      case 4:
        setMessage("Monitoreo de signos vitales en curso...");
        enableNext(false);
        startMonitoring();
        break;
      case 5:
        setMessage("Procedimiento finalizado con éxito. Puedes reiniciar para jugar otra vez.");
        enableNext(false);
        break;
    }
  }

  // Extraer corazón (clic sobre corazón cerdo)
  pigHeart.addEventListener("click", () => {
    if(state.stage !== 1) return;
    if(state.heartExtracted) return;
    state.heartExtracted = true;
    setMessage("Corazón extraído con éxito y almacenado para implantación.");
    enableNext(true);
  });

  // Crear corazón flotante para arrastrar
  function createFloatingHeart() {
    if (floatingHeart) return;
    floatingHeart = document.createElement("div");
    floatingHeart.style.position = "fixed";
    floatingHeart.style.left = "50%";
    floatingHeart.style.top = "50%";
    floatingHeart.style.marginLeft = "-28px";
    floatingHeart.style.marginTop = "-28px";
    floatingHeart.style.width = "56px";
    floatingHeart.style.height = "56px";
    floatingHeart.style.cursor = "grab";
    floatingHeart.style.zIndex = 9999;
    floatingHeart.setAttribute("aria-label", "Corazón para implantar");
    floatingHeart.setAttribute("role", "button");
    floatingHeart.innerHTML = `
      <svg viewBox="-40 -40 80 80" width="56" height="56" aria-hidden="true" focusable="false">
        <path d="M0 -22 C -9 -34 -32 -34 -32 -9 C -32 5 -15 15 0 32 C 15 15 32 5 32 -9 C 32 -34 9 -34 0 -22 Z" fill="#ff6b6b"/>
      </svg>
    `;
    document.body.appendChild(floatingHeart);

    floatingHeart.style.touchAction = "none";

    floatingHeart.addEventListener("pointerdown", e => {
      e.preventDefault();
      state.draggingHeart = true;
      floatingHeart.style.cursor = "grabbing";
    });
  }

  window.addEventListener("pointermove", e => {
    if(state.draggingHeart && floatingHeart) {
      floatingHeart.style.left = `${e.clientX}px`;
      floatingHeart.style.top = `${e.clientY}px`;
    }
  });

  window.addEventListener("pointerup", e => {
    if(state.draggingHeart) {
      state.draggingHeart = false;
      if(floatingHeart) floatingHeart.style.cursor = "grab";
      // Verificar si está cerca del pecho humano
      const chestRect = humanChest.getBoundingClientRect();
      const distX = e.clientX - (chestRect.left + chestRect.width / 2);
      const distY = e.clientY - (chestRect.top + chestRect.height / 2);
      const dist = Math.sqrt(distX*distX + distY*distY);
      if(dist < 80 && state.stage === 3) {
        implantHeart();
      }
    }
  });

  function implantHeart() {
    if(floatingHeart) {
      floatingHeart.remove();
      floatingHeart = null;
    }
    state.stage = 4;
    setMessage("Corazón implantado. Comienza el monitoreo de signos vitales.");
    enableNext(false);
    updateStatus();
    startMonitoring();
  }

  let monitorInterval = null;
  function startMonitoring() {
    let ticks = 0;
    monitorInterval = setInterval(() => {
      const change = Math.floor(Math.random() * 5) - 2;
      state.vitals += change;
      if(state.vitals < 60) state.vitals = 60;
      if(state.vitals > 100) state.vitals = 100;
      setMessage(`Monitoreo en curso. Ritmo cardíaco: ${state.vitals} bpm.`);
      ticks++;
      if(ticks >= 12) {
        clearInterval(monitorInterval);
        state.stage = 5;
        setMessage("Monitoreo completado con éxito. Procedimiento finalizado.");
        enableNext(false);
        resetBtn.disabled = false;
        updateStatus();
      }
    }, 1000);
  }

  nextBtn.addEventListener("click", () => {
    if(state.stage === 0) {
      state.stage = 1;
      startStage();
    } else if(state.stage === 1) {
      if(!state.heartExtracted) {
        setMessage("Debes extraer el corazón del cerdo para continuar.");
        return;
      }
      state.stage = 2;
      startStage();
    } else if(state.stage === 2) {
      state.stage = 3;
      startStage();
    }
  });

  resetBtn.addEventListener("click", () => {
    if(monitorInterval) clearInterval(monitorInterval);
    state = {
      stage: 0,
      heartExtracted: false,
      compatibilityPassed: false,
      vitals: 75,
      score: 0,
      draggingHeart: false,
    };
    if(floatingHeart) {
      floatingHeart.remove();
      floatingHeart = null;
    }
    setMessage("Por favor, ponte los guantes para iniciar el procedimiento.");
    updateStatus();
    enableNext(true);
    resetBtn.disabled = true;
  });

  // Inicio
  startStage();
</script>

</body>
</html>
